Embedded Java\+Script templates

\href{https://travis-ci.org/mde/ejs}{\tt } \href{https://david-dm.org/mde/ejs?type=dev}{\tt } \href{https://snyk.io/test/npm/ejs}{\tt }

\subsection*{Installation}


\begin{DoxyCode}
$ npm install ejs
\end{DoxyCode}


\subsection*{Features}


\begin{DoxyItemize}
\item Control flow with {\ttfamily $<$\% \%$>$}
\item Escaped output with {\ttfamily $<$\%= \%$>$} (escape function configurable)
\item Unescaped raw output with {\ttfamily $<$\%-\/ \%$>$}
\item Newline-\/trim mode (\textquotesingle{}newline slurping\textquotesingle{}) with {\ttfamily -\/\%$>$} ending tag
\item Whitespace-\/trim mode (slurp all whitespace) for control flow with {\ttfamily $<$\+\_\+ \+\_\+\%$>$}
\item Custom delimiters (e.\+g., use {\ttfamily $<$? ?$>$} instead of {\ttfamily $<$\% \%$>$})
\item Includes
\item Client-\/side support
\item Static caching of intermediate Java\+Script
\item Static caching of templates
\item Complies with the \href{http://expressjs.com}{\tt Express} view system
\end{DoxyItemize}

\subsection*{Example}


\begin{DoxyCode}
<% if (user) \{ %>
  <h2><%= user.name %></h2>
<% \} %>
\end{DoxyCode}


Try E\+JS online at\+: \href{https://ionicabizau.github.io/ejs-playground/}{\tt https\+://ionicabizau.\+github.\+io/ejs-\/playground/}.

\subsection*{Usage}


\begin{DoxyCode}
let template = ejs.compile(str, options);
template(data);
// => Rendered HTML string

ejs.render(str, data, options);
// => Rendered HTML string

ejs.renderFile(filename, data, options, function(err, str)\{
    // str => Rendered HTML string
\});
\end{DoxyCode}


It is also possible to use {\ttfamily ejs.\+render(data\+And\+Options);} where you pass everything in a single object. In that case, you\textquotesingle{}ll end up with local variables for all the passed options. However, be aware that your code could break if we add an option with the same name as one of your data object\textquotesingle{}s properties. Therefore, we do not recommend using this shortcut.

\subsection*{Options}


\begin{DoxyItemize}
\item {\ttfamily cache} Compiled functions are cached, requires {\ttfamily filename}
\item {\ttfamily filename} The name of the file being rendered. Not required if you are using {\ttfamily render\+File()}. Used by {\ttfamily cache} to key caches, and for includes.
\item {\ttfamily root} Set project root for includes with an absolute path (/file.ejs).
\item {\ttfamily context} Function execution context
\item {\ttfamily compile\+Debug} When {\ttfamily false} no debug instrumentation is compiled
\item {\ttfamily client} When {\ttfamily true}, compiles a function that can be rendered in the browser without needing to load the E\+JS Runtime (\href{https://github.com/mde/ejs/releases/latest}{\tt ejs.\+min.\+js}).
\item {\ttfamily delimiter} Character to use with angle brackets for open/close
\item {\ttfamily debug} Output generated function body
\item {\ttfamily strict} When set to {\ttfamily true}, generated function is in strict mode
\item {\ttfamily \+\_\+with} Whether or not to use {\ttfamily with() \{\}} constructs. If {\ttfamily false} then the locals will be stored in the {\ttfamily locals} object. Set to {\ttfamily false} in strict mode.
\item {\ttfamily locals\+Name} Name to use for the object storing local variables when not using {\ttfamily with} Defaults to {\ttfamily locals}
\item {\ttfamily rm\+Whitespace} Remove all safe-\/to-\/remove whitespace, including leading and trailing whitespace. It also enables a safer version of {\ttfamily -\/\%$>$} line slurping for all scriptlet tags (it does not strip new lines of tags in the middle of a line).
\item {\ttfamily escape} The escaping function used with {\ttfamily $<$\%=} construct. It is used in rendering and is {\ttfamily .to\+String()}ed in the generation of client functions. (By default escapes X\+ML).
\item {\ttfamily output\+Function\+Name} Set to a string (e.\+g., \textquotesingle{}echo\textquotesingle{} or \textquotesingle{}print\textquotesingle{}) for a function to print output inside scriptlet tags.
\item {\ttfamily async} When {\ttfamily true}, E\+JS will use an async function for rendering. (Depends on async/await support in the JS runtime.
\end{DoxyItemize}

This project uses \href{http://usejsdoc.org/}{\tt J\+S\+Doc}. For the full public A\+PI documentation, clone the repository and run {\ttfamily npm run doc}. This will run J\+S\+Doc with the proper options and output the documentation to {\ttfamily out/}. If you want the both the public \& private A\+PI docs, run {\ttfamily npm run devdoc} instead.

\subsection*{Tags}


\begin{DoxyItemize}
\item {\ttfamily $<$\%} \textquotesingle{}Scriptlet\textquotesingle{} tag, for control-\/flow, no output
\item {\ttfamily $<$\+\_\+} \textquotesingle{}Whitespace Slurping\textquotesingle{} Scriptlet tag, strips all whitespace before it
\item {\ttfamily $<$\%=} Outputs the value into the template (escaped)
\item {\ttfamily $<$\%-\/} Outputs the unescaped value into the template
\item {\ttfamily $<$\%\#} Comment tag, no execution, no output
\item {\ttfamily $<$\%\%} Outputs a literal \textquotesingle{}$<$\textquotesingle{}
\item {\ttfamily \%\%$>$} Outputs a literal \textquotesingle{}\%$>$\textquotesingle{}
\item {\ttfamily \%$>$} Plain ending tag
\item {\ttfamily -\/\%$>$} Trim-\/mode (\textquotesingle{}newline slurp\textquotesingle{}) tag, trims following newline
\item {\ttfamily \+\_\+\%$>$} \textquotesingle{}Whitespace Slurping\textquotesingle{} ending tag, removes all whitespace after it
\end{DoxyItemize}

For the full syntax documentation, please see https\+://github.com/mde/ejs/blob/master/docs/syntax.\+md \char`\"{}docs/syntax.\+md\char`\"{}.

\subsection*{Includes}

Includes either have to be an absolute path, or, if not, are assumed as relative to the template with the {\ttfamily include} call. For example if you are including {\ttfamily ./views/user/show.ejs} from {\ttfamily ./views/users.ejs} you would use `$<$\%-\/ include(\textquotesingle{}user/show') \%$>$\`{}.

You must specify the {\ttfamily filename} option for the template with the {\ttfamily include} call unless you are using {\ttfamily render\+File()}.

You\textquotesingle{}ll likely want to use the raw output tag ({\ttfamily $<$\%-\/}) with your include to avoid double-\/escaping the H\+T\+ML output.


\begin{DoxyCode}
<ul>
  <% users.forEach(function(user)\{ %>
    <%- include('user/show', \{user: user\}) %>
  <% \}); %>
</ul>
\end{DoxyCode}


Includes are inserted at runtime, so you can use variables for the path in the {\ttfamily include} call (for example {\ttfamily $<$\%-\/ include(some\+Path) \%$>$}). Variables in your top-\/level data object are available to all your includes, but local variables need to be passed down.

N\+O\+TE\+: Include preprocessor directives ({\ttfamily $<$\% include user/show \%$>$}) are still supported.

\subsection*{Custom delimiters}

Custom delimiters can be applied on a per-\/template basis, or globally\+:


\begin{DoxyCode}
let ejs = require('ejs'),
    users = ['geddy', 'neil', 'alex'];

// Just one template
ejs.render('<?= users.join(" | "); ?>', \{users: users\}, \{delimiter: '?'\});
// => 'geddy | neil | alex'

// Or globally
ejs.delimiter = '$';
ejs.render('<$= users.join(" | "); $>', \{users: users\});
// => 'geddy | neil | alex'
\end{DoxyCode}


\subsection*{Caching}

E\+JS ships with a basic in-\/process cache for caching the intermediate Java\+Script functions used to render templates. It\textquotesingle{}s easy to plug in L\+RU caching using Node\textquotesingle{}s {\ttfamily lru-\/cache} library\+:


\begin{DoxyCode}
let ejs = require('ejs'),
    LRU = require('lru-cache');
ejs.cache = LRU(100); // LRU cache with 100-item limit
\end{DoxyCode}


If you want to clear the E\+JS cache, call {\ttfamily ejs.\+clear\+Cache}. If you\textquotesingle{}re using the L\+RU cache and need a different limit, simple reset {\ttfamily ejs.\+cache} to a new instance of the L\+RU.

\subsection*{Custom file loader}

The default file loader is {\ttfamily fs.\+read\+File\+Sync}, if you want to customize it, you can set ejs.\+file\+Loader.


\begin{DoxyCode}
let ejs = require('ejs');
let myFileLoad = function (filePath) \{
  return 'myFileLoad: ' + fs.readFileSync(filePath);
\};

ejs.fileLoader = myFileLoad;
\end{DoxyCode}


With this feature, you can preprocess the template before reading it.

\subsection*{Layouts}

E\+JS does not specifically support blocks, but layouts can be implemented by including headers and footers, like so\+:


\begin{DoxyCode}
<%- include('header') -%>
<h1>
  Title
</h1>
<p>
  My page
</p>
<%- include('footer') -%>
\end{DoxyCode}


\subsection*{Client-\/side support}

Go to the \href{https://github.com/mde/ejs/releases/latest}{\tt Latest Release}, download {\ttfamily ./ejs.js} or {\ttfamily ./ejs.min.\+js}. Alternately, you can compile it yourself by cloning the repository and running {\ttfamily jake build} (or {\ttfamily \$(npm bin)/jake build} if jake is not installed globally).

Include one of these files on your page, and {\ttfamily ejs} should be available globally.

\subsubsection*{Example}


\begin{DoxyCode}
<div id="output"></div>
<script src="ejs.min.js"></script>
<script>
  let people = ['geddy', 'neil', 'alex'],
      html = ejs.render('<%= people.join(", "); %>', \{people: people\});
  // With jQuery:
  $('#output').html(html);
  // Vanilla JS:
  document.getElementById('output').innerHTML = html;
</script>
\end{DoxyCode}


\subsubsection*{Caveats}

Most of E\+JS will work as expected; however, there are a few things to note\+:


\begin{DoxyEnumerate}
\item Obviously, since you do not have access to the filesystem, {\ttfamily ejs.\+render\+File()} won\textquotesingle{}t work.
\item For the same reason, {\ttfamily include}s do not work unless you use an {\ttfamily include callback}. Here is an example\+: 
\begin{DoxyCode}
let str = "Hello <%= include('file', \{person: 'John'\}); %>",
    fn = ejs.compile(str, \{client: true\});

fn(data, null, function(path, d)\{ // include callback
  // path -> 'file'
  // d -> \{person: 'John'\}
  // Put your code here
  // Return the contents of file as a string
\}); // returns rendered string
\end{DoxyCode}

\end{DoxyEnumerate}

\subsubsection*{I\+DE Integration with Syntax Highlighting}

V\+S\+Code\+:Javascript E\+JS by {\itshape Digital\+Brainstem}

\subsection*{Related projects}

There are a number of implementations of E\+JS\+:


\begin{DoxyItemize}
\item TJ\textquotesingle{}s implementation, the v1 of this library\+: \href{https://github.com/tj/ejs}{\tt https\+://github.\+com/tj/ejs}
\item Jupiter Consulting\textquotesingle{}s E\+JS\+: \href{http://www.embeddedjs.com/}{\tt http\+://www.\+embeddedjs.\+com/}
\item E\+JS Embedded Java\+Script Framework on Google Code\+: \href{https://code.google.com/p/embeddedjavascript/}{\tt https\+://code.\+google.\+com/p/embeddedjavascript/}
\item Sam Stephenson\textquotesingle{}s Ruby implementation\+: \href{https://rubygems.org/gems/ejs}{\tt https\+://rubygems.\+org/gems/ejs}
\item Erubis, an E\+RB implementation which also runs Java\+Script\+: \href{http://www.kuwata-lab.com/erubis/users-guide.04.html#lang-javascript}{\tt http\+://www.\+kuwata-\/lab.\+com/erubis/users-\/guide.\+04.\+html\#lang-\/javascript}
\item Digital\+Brainstem E\+JS Language support\+: \href{https://github.com/Digitalbrainstem/ejs-grammar}{\tt https\+://github.\+com/\+Digitalbrainstem/ejs-\/grammar}
\end{DoxyItemize}

\subsection*{License}

Licensed under the Apache License, Version 2.\+0 (\href{http://www.apache.org/licenses/LICENSE-2.0}{\tt http\+://www.\+apache.\+org/licenses/\+L\+I\+C\+E\+N\+S\+E-\/2.\+0})



 E\+JS Embedded Java\+Script templates copyright 2112 \href{mailto:mde@fleegix.org}{\tt mde@fleegix.\+org}. 